<script>
  $(document).ready(function(){
    $('.views-field-phone').each(function(){
      var string = $(this).html();
      $(this).html(string.substring(0,3) + '-' + string.substring(3,6) + '-' + string.substring(6,10))
    });
  });

</script>

<div class="overflowBox">
    <div class="donBox">
      <header class="reqHead" style="margin: 2% auto 5% auto; text-align: center;"><%= @donor.name.titleize %> </header>

      <ul class="account">

        <li>
          <div class="fill_label">
            <label for="name">Location:</label>
          </div>
          <div class="fill_p">
            <p><%= @donor.city %></p>
          </div>

        </li>
        <li><hr></li>

        <li>
          <div class="fill_label">
            <label for="name">Phone Number:</label>
          </div>
          <div class="fill_p">
            <p class="views-field-phone"><%= @donor.phone_number %></p>
          </div>

        <li><hr></li>


        <li>
          <div class="fill_label">
            <label for="name">E-mail:</label>
          </div>

          <div class="fill_p">
            <p><%= @donor.email %></p>
          </div>
        </li>

        <li><hr></li>
            <%= link_to "Edit Profile", edit_donor_path(session[:donor_id]), :class => "tfbutton" if session[:donor_id]%><br><br>
      </ul>


    </div>


    <div class="reqAcctBox" style="margin-top: 2%;">
      <div class="reqAcctBox_box">

        <header class="reqHead" style="margin: 2% auto 2% auto; text-align: center;">Active Contributions</header>

        <div class="reqInner">
          <nav class="menu">
              <% @contributions.each do |contribution| %>
                <% @requests.each do |request| %>
                  <% if contribution.request_id == request.id && ( request.end_date.nil? || request.end_date > Date.today ) %>
                  <ul class="parent-menu">
                    <li>
                    <div class="acc_reqMainContent">
                      <strong><%= link_to "#{contribution.resource_amount} #{request.resource}", request_path(request.id) if request.end_date.nil? || request.end_date >= Date.today %></strong>
                      <p><%= link_to "#{request.organization}", request_path(request.id) if request.end_date.nil? || request.end_date >= Date.today %></p>
                    </div>
                    <div class="acc_reqDate" style="float: right;"><%= "End Date: #{request.end_date}" if !request.end_date.nil? && request.end_date >= Date.today %>
                    </div>
                    <div class="acc_reqDate" style="float: right;"><%= "End Date: indefinite" if request.end_date.nil?  %>
                    </div>

                    <hr></hr>

                  </li>
                  </ul>
                  <% end %>
                <% end %>

              <% end %>
          </nav>
            <% if @requests.size == 0 %>
              <p> No requests active </p>
            <% end %>
        </div>

      </div>

      <div class="reqAcctBox_box2">
        <header class="reqHead" style="margin: 2% auto 2% auto; text-align: center;">Contribution History</header>

        <div class="reqInner">
          <nav class="menu">
            <% @contributions.each do |contribution| %>
             <% @requests.each do |request| %>
              <ul class="parent-menu">
                <li>
                  <div class="acc_reqMainContent">
                    <strong><%= link_to "#{contribution.resource_amount} #{request.resource}", request_path(request.id) if request.end_date.nil? || request.end_date > Date.today %></strong>
                    <p><%= link_to "#{request.organization}", request_path(request.id) if request.end_date.nil? || request.end_date > Date.today %></p>
                  </div>
                  <div class="acc_reqDate" style="float: right;"><%= "End Date: #{request.end_date}" if !request.end_date.nil? && request.end_date > Date.today %>
                  </div>
                  <div class="acc_reqDate" style="float: right;"><%= "End Date: indefinite" if request.end_date.nil?  %>
                  </div>
                <hr></hr>
                </li>
              </ul>
              <% end %>
            <% end %>
          </nav>
                    <% if @requests.size == 0 %>
                      <p> No requests in history </p>
                    <% end %>



        </div>
      </div>
    </div>
  </div>
</div>

